<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, user-scalable=no">
	<title>Seriously.js Camera Demo with slicer effect</title>
	<style type="text/css">
		body {
			margin: 0;
		}
		img {
			display: none;
		}
		#canvas {
			position: relative;
			top: 0;
			left: 0;
			width: 1024px;
			display:block;
		}
		button {
			padding:4px;
			margin-bottom:8px;
		}
		.controls{
			margin:16px;
		}
	</style>
</head>
<body>
	<canvas id="target" width="640" height="480"></canvas>
	
	<div class="controls">
		Slice positions &#160;
		<button id="reset">Reset</button>&#160;
		<button id="randomise">Randomise</button>&#160;
		<button disabled id="animate">Animate</button>&#160;
		<span>Todo: add slice position animation</span>
		
		<div>
			<label for="noiseAmount">Noise Amount</label>
			<input type="range" id="noiseAmount" min="0" max="1" step="0.001" value="0.05" style="width:512px" />
		</div>
		<div>
			<label for="ySpread">Y Spread</label>
			<input type="range" id="ySpread" min="0" max="128" step="0.1" value="16" style="width:512px" />
		</div>
		<div>
			<label for="blur-amount">Blur</label>
			<input type="range" id="blur-amount" min="0" max="1" step="0.001" value=".1" style="width:512px" />
		</div>
	</div>
	
	<script src="../../seriously.js"></script>
	<script src="../../sources/seriously.camera.js"></script>
	<script src="../../effects/seriously.slicer.js"></script>
	<script src="../../effects/seriously.blur.js"></script>
	<script>
	(function() {

		// declare our variables
		var srsly, // the main object that holds the entire composition
			source, // wrapper object for source video
			slicer, // slicer effect
			slicerControl,
			blur, // optional, add some blur to the output
			target; // a wrapper object for our target canvas

		if (Seriously.incompatible('camera')) {
			document.body.appendChild(document.createTextNode('Sorry, your browser does not support getUserMedia'));
			document.querySelector('canvas').style.display = 'none';
			return;
		}
		
		// construct our seriously object
		srsly = new Seriously();
		source = srsly.source('camera');
		target = srsly.target('#target');
		slicer = srsly.effect('slicer', slicerControl={});
		blur = srsly.effect('blur');
		
		// connect the nodes 
		slicer.source = source;
		blur.source = slicer;
		target.source = blur;
		
		// 
		// optional. some built-in utils - reset slices so they are evenly distributed, or randomise them.
		document.getElementById('reset').addEventListener('click', slicerControl.reset);
		document.getElementById('randomise').addEventListener('click',slicerControl.randomise);
		
		slicer.ySpread= '#ySpread';
		slicer.noiseAmount= '#noiseAmount';
		blur.amount = '#blur-amount';

		srsly.go(
			function(){
				// before render
				slicer.seed = 1.0 + Math.random() * 1024;
			}
		);
	}());
	</script>
	
</body>
</html>
